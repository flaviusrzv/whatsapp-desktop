name: Build WhatsApp Desktop - Windows Only

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ğŸŸ¢ Setup Node.js 24.x
        uses: actions/setup-node@v4
        with:
          node-version: '24.13.1'
          cache: 'npm'
      
      - name: ğŸ“¦ Install Yarn globally
        run: npm install -g yarn
      
      - name: ğŸ”§ Install root dependencies
        run: npm install
      
      - name: ğŸ”§ Install app dependencies
        working-directory: ./app
        run: yarn install
      
      - name: ğŸ—ï¸ Build Windows x64 (fÄƒrÄƒ asar - folder app/)
        shell: cmd
        run: |
          npx electron-packager ./app WhatsApp --overwrite --out=build/dist --package-manager=yarn --platform=win32 --arch=x64 --electron-version=40.6.0 --icon=build/assets/win/whatsapp.ico --no-asar
      
      - name: ğŸ“¦ Create build directory structure
        shell: powershell
        run: |
          New-Item -ItemType Directory -Force -Path build/releases
          Compress-Archive -Path build/dist/WhatsApp-win32-x64/* -DestinationPath build/releases/WhatsApp-win32-x64.zip -Force
      
      - name: ğŸ“¤ Upload Windows Build (Folder)
        uses: actions/upload-artifact@v4
        with:
          name: WhatsApp-Desktop-Windows-x64
          path: build/dist/WhatsApp-win32-x64/
          if-no-files-found: error
          retention-days: 30
      
      - name: ğŸ“¤ Upload Windows Build (ZIP)
        uses: actions/upload-artifact@v4
        with:
          name: WhatsApp-Desktop-Windows-x64-ZIP
          path: build/releases/WhatsApp-win32-x64.zip
          if-no-files-found: error
          retention-days: 30
